const axios = require("axios");
const fs = require("fs").promises;
const path = require("path");

async function saveHtml(response) {

  const tempDir = path.join(__dirname, "../files");
  const filePath = path.join(tempDir, 'index.html');

  try {
      try {
        await fs.access(tempDir);
      } catch (err) {
        await fs.mkdir(tempDir, { recursive: true });
      }

    await fs.writeFile(filePath, response.data, 'utf8');
    
    return false; // Retorna apenas após a escrita bem-sucedida
  } catch (err) {
    console.error('Error saving HTML:', err);
    return false; // Retorna após um erro de escrita
  }
}

async function fetchAndSaveHtml() {
  try {
    // const url = "https://pt.surebet.com/surebets";
    const url  = "https://pt.surebet.com/surebets?utf8=%E2%9C%93&filter%5Bselected%5D%5B%5D=&filter%5Bselected%5D%5B%5D=34024244&filter%5Bsave%5D=&filter%5Bcurrent_id%5D=34024244&selector%5Border%5D=start_at_asc&selector%5Boutcomes%5D%5B%5D=&selector%5Boutcomes%5D%5B%5D=2&selector%5Bmin_profit%5D=5&selector%5Bmax_profit%5D=&selector%5Bmin_roi%5D=&selector%5Bmax_roi%5D=&selector%5Bsettled_in%5D=43200&selector%5Bbookies_settings%5D=4%3A67%3A%3A%3B0%3A105%3A%3A%3B0%3A253%3A%3A%3B0%3A66%3A%3A%3B0%3A76%3A%3A%3B0%3A93%3A%3A%3B0%3A182%3A%3A%3B4%3A74%3A%3A%3B0%3A37%3A%3A%3B0%3A148%3A%3A%3B0%3A211%3A%3A%3B0%3A114%3A%3A%3B0%3A260%3A%3A%3B0%3A101%3A%3A%3B0%3A132%3A%3A%3B0%3A42%3A%3A%3B0%3A40%3A%3A%3B4%3A225%3A%3A%3B0%3A269%3A%3A%3B0%3A126%3A%3A%3B0%3A201%3A%3A%3B0%3A21%3A%3A%3B0%3A70%3A%3A%3B0%3A263%3A%3A%3B4%3A26%3A%3A%3B4%3A296%3A%3A%3B0%3A236%3A%3A%3B0%3A139%3A%3A%3B0%3A111%3A%3A%3B0%3A319%3A%3A%3B0%3A36%3A%3A%3B4%3A150%3A%3A%3B4%3A202%3A%3A%3B4%3A151%3A%3A%3B0%3A23%3A%3A%3B0%3A204%3A%3A%3B0%3A309%3A%3A%3B0%3A200%3A%3A%3B0%3A203%3A%3A%3B0%3A60%3A%3A%3B0%3A116%3A%3A%3B0%3A32%3A%3A%3B0%3A138%3A%3A%3B0%3A1%3A%3A%3B0%3A65%3A%3A%3B4%3A161%3A%3A%3B0%3A301%3A%3A%3B0%3A29%3A%3A%3B4%3A10%3A%3A%3B4%3A107%3A%3A%3B4%3A106%3A%3A%3B4%3A265%3A%3A%3B4%3A45%3A%3A%3B4%3A228%3A%3A%3B0%3A322%3A%3A%3B0%3A34%3A%3A%3B0%3A77%3A%3A%3B0%3A58%3A%3A%3B0%3A100%3A%3A%3B0%3A153%3A%3A%3B0%3A95%3A%3A%3B0%3A311%3A%3A%3B0%3A180%3A%3A%3B0%3A320%3A%3A%3B0%3A254%3A%3A%3B4%3A208%3A%3A%3B0%3A14%3A%3A%3B0%3A197%3A%3A%3B4%3A152%3A%3A%3B0%3A325%3A%3A%3B0%3A11%3A%3A%3B0%3A291%3A%3A%3B0%3A38%3A%3A%3B0%3A147%3A%3A%3B0%3A52%3A%3A%3B4%3A198%3A%3A%3B0%3A300%3A%3A%3B0%3A304%3A%3A%3B0%3A324%3A%3A%3B0%3A55%3A%3A%3B0%3A187%3A%3A%3B0%3A33%3A%3A%3B0%3A13%3A%3A%3B0%3A185%3A%3A%3B0%3A68%3A%3A%3B0%3A176%3A%3A%3B0%3A125%3A%3A%3B4%3A248%3A%3A%3B4%3A49%3A%3A%3B4%3A215%3A%3A%3B0%3A113%3A%3A%3B0%3A62%3A%3A%3B0%3A75%3A%3A%3B4%3A96%3A%3A%3B0%3A231%3A%3A%3B4%3A12%3A%3A%3B0%3A177%3A%3A%3B0%3A193%3A%3A%3B0%3A157%3A%3A%3B0%3A90%3A%3A%3B0%3A46%3A%3A%3B0%3A229%3A%3A%3B0%3A279%3A%3A%3B0%3A210%3A%3A%3B0%3A146%3A%3A%3B0%3A117%3A%3A%3B0%3A255%3A%3A%3B0%3A135%3A%3A%3B0%3A24%3A%3A%3B0%3A321%3A%3A%3B0%3A282%3A%3A%3B0%3A88%3A%3A%3B0%3A73%3A%3A%3B0%3A171%3A%3A%3B0%3A53%3A%3A%3B0%3A261%3A%3A%3B0%3A144%3A%3A%3B0%3A312%3A%3A%3B0%3A121%3A%3A%3B0%3A331%3A%3A%3B0%3A154%3A%3A%3B0%3A129%3A%3A%3B0%3A234%3A%3A%3B0%3A214%3A%3A%3B0%3A274%3A%3A%3B0%3A56%3A%3A%3B0%3A170%3A%3A%3B0%3A276%3A%3A%3B0%3A104%3A%3A%3B4%3A108%3A%3A%3B0%3A230%3A%3A%3B4%3A22%3A%3A%3B0%3A290%3A%3A%3B0%3A158%3A%3A%3B0%3A307%3A%3A%3B0%3A145%3A%3A%3B0%3A136%3A%3A%3B0%3A219%3A%3A%3B4%3A273%3A%3A%3B0%3A257%3A%3A%3B0%3A165%3A%3A%3B0%3A5%3A%3A%3B4%3A162%3A%3A%3B0%3A6%3A%3A%3B0%3A112%3A%3A%3B0%3A245%3A%3A%3B0%3A295%3A%3A%3B0%3A235%3A%3A%3B0%3A175%3A%3A%3B0%3A224%3A%3A%3B0%3A190%3A%3A%3B0%3A294%3A%3A%3B0%3A297%3A%3A%3B0%3A183%3A%3A%3B0%3A264%3A%3A%3B0%3A327%3A%3A%3B0%3A242%3A%3A%3B0%3A213%3A%3A%3B0%3A244%3A%3A%3B0%3A30%3A%3A%3B0%3A15%3A%3A%3B0%3A212%3A%3A%3B0%3A329%3A%3A%3B0%3A128%3A%3A%3B0%3A315%3A%3A%3B4%3A233%3A%3A%3B0%3A50%3A%3A%3B0%3A9%3A%3A%3B0%3A259%3A%3A%3B0%3A179%3A%3A%3B0%3A178%3A%3A%3B0%3A318%3A%3A%3B0%3A41%3A%3A%3B0%3A85%3A%3A%3B0%3A169%3A%3A%3B0%3A84%3A%3A%3B0%3A266%3A%3A%3B0%3A333%3A%3A%3B0%3A130%3A%3A%3B0%3A133%3A%3A%3B0%3A247%3A%3A%3B0%3A3%3A%3A%3B0%3A131%3A%3A%3B0%3A281%3A%3A%3B0%3A280%3A%3A%3B0%3A240%3A%3A%3B0%3A271%3A%3A%3B0%3A8%3A%3A%3B0%3A118%3A%3A%3B0%3A89%3A%3A%3B0%3A283%3A%3A%3B0%3A285%3A%3A%3B0%3A284%3A%3A%3B0%3A166%3A%3A%3B0%3A323%3A%3A%3B0%3A299%3A%3A%3B0%3A124%3A%3A%3B0%3A226%3A%3A%3B0%3A209%3A%3A%3B0%3A82%3A%3A%3B0%3A63%3A%3A%3B4%3A83%3A%3A%3B0%3A98%3A%3A%3B0%3A99%3A%3A%3B0%3A167%3A%3A%3B0%3A137%3A%3A%3B0%3A258%3A%3A%3B0%3A141%3A%3A%3B0%3A19%3A%3A%3B0%3A142%3A%3A%3B4%3A164%3A%3A%3B0%3A278%3A%3A%3B0%3A249%3A%3A%3B0%3A39%3A%3A%3B4%3A174%3A%3A%3B0%3A31%3A%3A%3B0%3A54%3A%3A%3B0%3A194%3A%3A%3B0%3A326%3A%3A%3B0%3A316%3A%3A%3B0%3A317%3A%3A%3B0%3A251%3A%3A%3B0%3A51%3A%3A%3B0%3A181%3A%3A%3B0%3A103%3A%3A%3B4%3A2%3A%3A%3B0%3A143%3A%3A%3B0%3A122%3A%3A%3B4%3A7%3A%3A%3B0%3A172%3A%3A%3B0%3A237%3A%3A%3B0%3A168%3A%3A%3B0%3A330%3A%3A%3B4%3A156%3A%3A%3B0%3A272%3A%3A%3B0%3A293%3A%3A%3B0%3A47%3A%3A%3B0%3A305%3A%3A%3B0%3A134%3A%3A%3B0%3A306%3A%3A%3B0%3A218%3A%3A%3B0%3A302%3A%3A%3B4%3A123%3A%3A%3B0%3A94%3A%3A%3B0%3A328%3A%3A%3B0%3A310%3A%3A%3B0%3A25%3A%3A%3B0%3A69%3A%3A%3B0%3A313%3A%3A%3B0%3A140%3A%3A%3B0%3A119%3A%3A%3B0%3A332%3A%3A%3B0%3A16%3A%3A%3B0%3A207%3A%3A%3B0%3A287%3A%3A%3B0%3A232%3A%3A%3B0%3A48%3A%3A%3B0%3A223%3A%3A%3B0%3A163%3A%3A%3B0%3A256%3A%3A%3B0%3A97%3A%3A%3B4%3A173%3A%3A%3B4%3A191%3A%3A%3B0%3A186%3A%3A%3B0%3A192%3A%3A%3B0%3A270%3A%3A%3B0%3A43%3A%3A%3B0%3A243%3A%3A%3B4%3A267%3A%3A%3B0%3A199%3A%3A%3B0%3A91%3A%3A%3B0%3A289%3A%3A%3B0%3A275%3A%3A%3B0%3A184%3A%3A%3B0%3A18%3A%3A%3B0%3A59%3A%3A%3B0%3A64%3A%3A%3B0%3A216%3A%3A%3B0%3A314%3A%3A%3B0%3A86%3A%3A%3B0%3A120%3A%3A%3B0%3A277%3A%3A%3B0%3A149%3A%3A%3B0%3A127%3A%3A%3B0%3A115%3A%3A%3B0%3A17%3A%3A%3B0%3A160%3A%3A%3B0%3A110%3A%3A%3B0%3A238%3A%3A%3B0%3A102%3A%3A%3B0%3A239%3A%3A%3B0%3A217%3A%3A%3B0%3A303%3A%3A%3B0%3A28%3A%3A%3B0%3A220%3A%3A%3B0%3A222%3A%3A%3B0%3A250%3A%3A%3B0%3A252%3A%3A%3B0%3A44%3A%3A%3B0%3A196%3A%3A%3B0%3A308%3A%3A%3B0%3A227%3A%3A%3B0%3A206%3A%3A%3B0%3A155%3A%3A%3B0%3A195%3A%3A%3B0%3A221%3A%3A%3B0%3A71%3A%3A%3B0%3A79%3A%3A%3B0%3A80%3A%3A%3B0%3A78%3A%3A%3B0%3A81%3A%3A%3B0%3A27%3A%3A&selector%5Bexclude_sports_ids_str%5D=-&selector%5Btournaments_categories%5D=men+women+adults+youth+main+reserve&selector%5Bis_tournaments_enabled%5D=true&selector%5Bis_tournaments_categories_enabled%5D=true&selector%5Btournaments_action%5D=add&selector%5Btournaments%5D=&selector%5Bextra_filters%5D=&selector%5Bextra_complex_conditions%5D=&commit=Filtrar&narrow="
    const headers = {
      accept:
        "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
      cookie: "uu=e44500ee-8083-4fb7-a117-df4e54517dfa; ab=582; timezoneOffset=180; browser.timezone=America/Sao_Paulo; timezoneOffset=180; _ga=GA1.2.1314313991.1722114496; _gid=GA1.2.907722579.1722114496; ad_checker=2024-07-28; sel.surebets=55afd23db493f0bd573a5295006fd6db; remember_user_token=eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaGJDRnNHYVFNZDhRUkpJaGx3VTBkU09VNU1UbnB6YzNWb2R6WjFZM3BJUndZNkJrVlVTU0lYTVRjeU1qSTFPVEV3TVM0NU5qSXdPRE16QmpzQVJnPT0iLCJleHAiOiIyMDI3LTA3LTI5VDEzOjE4OjIxLjk2MloiLCJwdXIiOm51bGx9fQ%3D%3D--362f5e621f1e366acfc0838f69fcf8b1226918a2; order_valuebets_index=probability_asc; calculator.auto.height=1001; calculator.auto.width=1724; cf_clearance=If_JglIEw_OaJOFnqac.Z3IajUrR.0_ahkKCEUSmGSs-1722427626-1.0.1.1-ZotxY3LIpebx6__mTPSuoOymrbR3yWFrOdRE_S_WfcEo81hC42O_cJl4FAL6VpPMqatrfH6R602VDbiwSHB4OA; order_surebets_index=start_at_asc; stoken=28708857-b328ad1fe94db963f29caf43b2afe0c066d8b91e; _gat_gtag_UA_1803143_12=1; _ga_4H2DFG8NDS=GS1.2.1722530661.21.1.1722531433.0.0.0; sstoken=28708857-b328ad1fe94db963f29caf43b2afe0c066d8b91e-28708857-86246c39cbdec2369756efc7efa294c6b2cf1c38; ref=TXJsZm84YTRFUStDY0g3MmNsMlpFa3JETG05RHdOZ2lIc2lhbXdZeFpISkNaeTZpZjZ6Z2ZNUkRaY3FtOHhPM3MxcHhPVmxNdVVUT29UVTh6cmllREcxbTlISTd0enFQVmxMYlM3ZFIzVituZVJ4UTZ5SUNEdWVOOU8zaFZOS3MtLXlxQnFmcXhqTERqam5Eb3V6eEZCeFE9PQ%3D%3D--bf96cbbfee41c593538f035b396c989717cabe56; br=WCtZdDA0YzBQeUgrdlROQTk3ZjdTTHd0WUJaNmwyLzBta3pVSlZUTUFvd0dkb1BmRERzOHBEMlVMWTlCc2w0d0lWdDlUNzFTNkJNTXBuMldXYkhtRmpPbkU4a2ZnOFVpbDI0Ry9YN2JqMFlwOVh2UHR4SndpZC92K1lzcFcvNXlHb0ZCVTYyRE5jSkgwVkRzdmQ3alRYdmVtbjZubVNQcmlrRUlBTGtiN3ZIcUwydUNvanZ0cGFhN0dVeEpFNlBnaDJMTW1kbGRyd2RDV3czaldwUS9WYVo4b3lHdGlHcmxPY0wvN1h5dUZyOD0tLWh5Mk5tM2Q1bVFhUXErK253Y1lDQlE9PQ%3D%3D--bf75582b4653300c728a1df4298788acbd6d250d; _sp5=REtvQVpGSzZHY3N5akJrTUcyc2loYUI5bjBNYWZENFcxWnZMMmh0eXJWNDFZM1ZTQTl3UmRGY3pFQU1JSjViV2c4Z2NnZ1ljbWxQR0pxL3pGOUZsS09VRWlwNVJlSXIzbkU2cjVBcGgzcm1ZOEo4N1VyM3JmSi9QaG5NWENGVTdzNitqTVNMTExTTkNqS2QxSG43VXpXMjdZRTdPdW1aSUhhRUZyQU8yZWlCTmFtaU1IbVdtOEZheFUwNWU1dUtkcSszME91MzZXT285bW5qYWs1VDNVTXhUblllMzNyVFQ5eGl4UG12bHRvTzJzTkI1T1hOai8xd0swSndVdzRML0E1cTkzMjFoWWkrVm9wYzFBbVJRTDRpR1JYbEpUYm1mcHVCM1lIY1BKRzNuMEZmUUU1QjNMVkxLdS9ZMnJEdkR6K2pabjY3WmdpMDIveVdQTVA1cWFGYUIxN3FXd3dSUHFlUkZZcEhReC9EWmh0SlpIcURYUUp0bWs2c1FZL1J0LS1HTGNQT0tybjFvTmRkanBoZS9xNUlnPT0%3D--e2ba43dc8db6751858d9cd2484658577619f2fb2"
      };
    const response = await axios.get(url, { headers });
    const result = await saveHtml(response);
    return result;
  } catch (error) {
    console.error("Erro ao fazer a requisição ou salvar o arquivo:", error);

    saveErrorToFile(error)
  }
}


function saveErrorToFile(error) {
  const errorString = JSON.stringify(error, Object.getOwnPropertyNames(error), 2);
  fs.writeFile('./error_log.txt', errorString, (err) => {
    if (err) {
      console.error('Erro ao salvar o arquivo:', err);
    } else {
      console.log('Erro salvo no arquivo error_log.txt');
    }
  });
}

module.exports = fetchAndSaveHtml;
